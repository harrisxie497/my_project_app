非常好，这一步你说得很关键 👍
**“保存起来，然后供检查验证”**，意味着这份内容要具备三个特性：

1. **可长期保存**（结构稳定，不是聊天记录）
2. **可核对**（逐列、逐规则、可对 Excel）
3. **可作为验收标准**（配置 / 结果 / 代码都能对照）

所以我会把刚才的逐列分析，**整理成一份「正式的规则校验文档」**，你可以直接：

* 存成 `md / doc / wiki`
* 作为 **配置验收清单**
* 未来改规则时，用它做 diff 对照

下面是**最终版文档内容**👇
（我用 Markdown，你直接保存即可）

---

# 派送文件（佐川指定时间带）字段规则校验文档

**文档用途**

* 用于校验 Excel 配置是否正确
* 用于验证派送结果文件是否符合业务规则
* 用于研发 / 业务 / 运维的统一对照标准

**适用范围**

* 文件类型：`delivery`
* 模板：`TPL_DELIVERY_SAGAWA_SPEEDY_V1`
* 源文件：《佐川指定时间带表格源文件》
* 结果文件：《派送文件成品》
* Sheet：`Speedy`

---

## 一、总体规则说明

### 1. 处理流程

* Step 1：字段映射（MAP）
* Step 2：字段处理（PROCESS）

### 2. 核心原则

* 目标文件 **A–Y 列必须全部存在**
* MAP 只决定「值从哪来」
* PROCESS 决定「值如何修正 / 校验」
* 不允许在 MAP 中做业务逻辑
* 不允许在 PROCESS 中改变值来源

---

## 二、逐列规则说明（校验清单）

> 校验时请逐列对照 **源文件 → 配置 → 结果文件**

---

### A｜お客様管理番号（客户管理编号）

* **业务含义**：业务唯一标识
* **MAP**：COPY ← 源文件 A
* **PROCESS**：COPY（不处理）
* **依赖关系**：被 Q 列依赖
* **校验要点**：

  * 结果文件 A 与源文件 A 必须一致
  * 不允许为空

---

### B｜佐川問合せ番号HAWB

* **MAP**：COPY
* **PROCESS**：COPY
* **校验要点**：

  * 完全透传

---

### C｜配達指定日

* **MAP**：COPY
* **PROCESS**：COPY
* **业务角色**：D 列的判断条件
* **校验要点**：

  * 本列值本身不修改
  * 是否为空会影响 D 列

---

### D｜時間帯指定（重点）

* **MAP**：COPY
* **PROCESS**：FORMAT + DEFAULT
* **依赖列**：C、D

**规则：**

| 条件            | 处理结果       |
| ------------- | ---------- |
| C 不为空 且 D = 0 | D → `"00"` |
| C 为空 且 D = 0  | D → `""`   |
| 其他情况          | 原样保留       |

* **校验要点**：

  * 不能在 MAP 阶段处理
  * 必须按条件区分

---

### E｜貨物個数

* **MAP**：COPY
* **PROCESS**：COPY
* **校验要点**：

  * 不允许被修改

---

### F｜お届け先人名

### G｜お届け先住所

### H｜お届け先電話

### I｜お届け先郵便

* **MAP**：COPY
* **PROCESS**：COPY
* **校验要点**：

  * 结果文件必须与源文件一致

---

### J｜依頼主

* **MAP**：COPY
* **PROCESS**：DEFAULT
* **规则**：

  * 空 → `"DIDA"`
* **校验要点**：

  * 结果文件中不得为空

---

### K｜依頼主住所

* **MAP**：COPY
* **PROCESS**：DEFAULT
* **规则**：

  * 空 → 固定默认地址
* **校验要点**：

  * 结果文件中不得为空

---

### L｜依頼主郵便番号

* **MAP**：COPY
* **PROCESS**：COPY

---

### M｜依頼主電話

* **MAP**：COPY
* **PROCESS**：DEFAULT
* **规则**：

  * 空 → `"0471377848"`

---

### N｜佐川顧客コード（固定）

* **MAP**：COPY
* **PROCESS**：COPY
* **说明**：

  * 虽然是“固定”，但来源已在源文件中

---

### O｜記事欄2（品名）

* **MAP**：COPY
* **PROCESS**：COPY

---

### P｜記事欄2（人工输入）

* **MAP**：DERIVE / INPUT_PARAM
* **来源**：页面参数 `article2_input`
* **PROCESS**：

  * 必填校验（required = true）
* **校验要点**：

  * 页面未输入必须阻断处理

---

### Q｜記事欄3

* **MAP**：COPY
* **PROCESS**：CALC
* **规则**：

  * 空 → 复制 A 列（お客様管理番号）
* **校验要点**：

  * 不允许最终为空

---

### R–Y｜空列（删除字段）

* **MAP**：CONST `""`
* **PROCESS**：COPY
* **说明**：

  * 用于保持佐川模板结构
  * 不承载业务数据

---

## 三、汇总校验表（快速检查用）

| 列   | MAP         | PROCESS        | 依赖  |
| --- | ----------- | -------------- | --- |
| A   | COPY        | COPY           | → Q |
| B   | COPY        | COPY           |     |
| C   | COPY        | COPY           | → D |
| D   | COPY        | FORMAT+DEFAULT | C   |
| E   | COPY        | COPY           |     |
| F–I | COPY        | COPY           |     |
| J   | COPY        | DEFAULT        |     |
| K   | COPY        | DEFAULT        |     |
| L   | COPY        | COPY           |     |
| M   | COPY        | DEFAULT        |     |
| N–O | COPY        | COPY           |     |
| P   | INPUT_PARAM | REQUIRED       |     |
| Q   | COPY        | CALC           | A   |
| R–Y | CONST       | COPY           |     |

---

## 四、使用方式（建议）

* **配置评审**：对照本表逐列 Review
* **测试验收**：抽样 Excel，人工核对 D / J / K / M / P / Q
* **问题定位**：

  * 值来源错 → 查 MAP
  * 值修正错 → 查 PROCESS

---

如果你愿意，下一步我可以帮你把这份内容再做两件事之一（都非常实用）：

1️⃣ **生成一份“Excel 校验 Checklist”**（给测试/运营直接勾选）
2️⃣ **把这份规则文档和你 DB 中的 rule_items 自动比对，输出差异报告思路**

你告诉我选哪个，我继续。
